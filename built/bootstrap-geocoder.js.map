{"version":3,"file":"bootstrap-geocoder.js","sources":["../src/GeosearchInput.js"],"sourcesContent":["import { DomUtil, DomEvent, Util, Layer } from 'leaflet';\nimport { Util as EsriUtil } from 'esri-leaflet';\nimport { geosearchCore, arcgisOnlineProvider } from 'esri-leaflet-geocoder';\n\nexport var Search = Layer.extend({\n  options: {\n    allowMultipleResults: true,\n    placeholder: 'Search for places or addresses',\n    title: 'Location Search',\n    wrapperStyle: 'input-group',\n    suggestionGroupStyle: 'dropdown-menu',\n    selectedStyle: 'geocoder-control-selected'\n  },\n\n  initialize: function (options) {\n    Util.setOptions(this, options);\n\n    // this demo only supports one provider\n    if (!options.providers) {\n      options.providers = [ arcgisOnlineProvider() ];\n    }\n\n    // instantiate the underlying class and pass along options\n    this._geosearchCore = geosearchCore(this, options);\n    this._geosearchCore.addEventParent(this);\n\n    this._geosearchCore._pendingSuggestions = [];\n\n    // bubble provider events up to the control\n    this._geosearchCore._providers[0].addEventParent(this);\n  },\n\n  _renderSuggestions: function (suggestions) {\n    var nodes = [];\n    var list;\n    var header;\n\n    var currentGroup;\n    this._suggestions.style.display = 'block';\n\n    for (var i = 0; i < suggestions.length; i++) {\n      var suggestion = suggestions[i];\n\n      if (!list) {\n        list = DomUtil.create('ul', null, this._suggestions);\n        list.style.display = 'block';\n      }\n\n      var suggestionItem = DomUtil.create('li', 'geocoder-control-suggestion', list);\n\n      suggestionItem.innerHTML = suggestion.text;\n      suggestionItem.provider = suggestion.provider;\n      suggestionItem['data-magic-key'] = suggestion.magicKey;\n    }\n\n    nodes.push(list);\n\n    return nodes;\n  },\n\n  clear: function () {\n    this._suggestions.innerHTML = '';\n    this._suggestions.style.display = 'none';\n    this._input.value = '';\n  },\n\n  clearSuggestions: function () {\n    if (this._nodes) {\n      for (var k = 0; k < this._nodes.length; k++) {\n        if (this._nodes[k].parentElement) {\n          this._suggestions.removeChild(this._nodes[k]);\n        }\n      }\n    }\n  },\n\n  onAdd: function (map) {\n    this._map = map;\n    EsriUtil.setEsriAttribution(map);\n\n    this._input = document.getElementById(this.options.inputTag);\n\n    // create a wrapper div around the input\n    this._wrapper = document.createElement('div');\n\n    DomUtil.addClass(this._wrapper, this.options.wrapperStyle);\n\n    this._input.parentNode.insertBefore(this._wrapper, this._input);\n    this._wrapper.appendChild(this._input);\n\n    this._input.title = this.options.title;\n\n    // create dom node for suggestions and place it below the input\n    this._suggestions = document.createElement('div');\n    DomUtil.addClass(this._suggestions, this.options.suggestionGroupStyle);\n\n    this._input.parentNode.insertBefore(this._suggestions, null);\n\n    DomEvent.addListener(this._input, 'focus', function (e) {\n      this._input.placeholder = this.options.placeholder;\n    }, this);\n\n    DomEvent.addListener(this._suggestions, 'mousedown', function (e) {\n      var suggestionItem = e.target || e.srcElement;\n      this._geosearchCore._geocode(suggestionItem.innerHTML, suggestionItem['data-magic-key'], suggestionItem.provider);\n      this.clear();\n    }, this);\n\n    DomEvent.addListener(this._input, 'blur', function (e) {\n      this._input.placeholder = '';\n      this.clear();\n    }, this);\n\n    DomEvent.addListener(this._input, 'keydown', function (e) {\n      var selectedStyle = this.options.selectedStyle;\n\n      var list = this._suggestions.querySelectorAll('.' + 'geocoder-control-suggestion');\n      var selected = this._suggestions.querySelectorAll('.' + selectedStyle)[0];\n      var selectedPosition;\n\n      for (var i = 0; i < list.length; i++) {\n        if (list[i] === selected) {\n          selectedPosition = i;\n          break;\n        }\n      }\n\n      switch (e.keyCode) {\n        case 13:  // enter\n          if (selected) {\n            this._geosearchCore._geocode(selected.innerText, selected['data-magic-key'], selected.provider);\n            this.clear();\n          } else if (this.options.allowMultipleResults) {\n            this._geosearchCore._geocode(this._input.value, undefined);\n            this.clear();\n          } else {\n            DomUtil.addClass(list[0], selectedStyle);\n          }\n          DomEvent.preventDefault(e);\n          break;\n        case 38: // up arrow\n          if (selected) {\n            L.DomUtil.removeClass(selected, selectedStyle);\n          }\n\n          var previousItem = list[selectedPosition - 1];\n\n          if (selected && previousItem) {\n            DomUtil.addClass(previousItem, selectedStyle);\n          } else {\n            DomUtil.addClass(list[list.length - 1], selectedStyle);\n          }\n          DomEvent.preventDefault(e);\n          break;\n        case 40: // down arrow\n          if (selected) {\n            DomUtil.removeClass(selected, selectedStyle);\n          }\n\n          var nextItem = list[selectedPosition + 1];\n\n          if (selected && nextItem) {\n            DomUtil.addClass(nextItem, selectedStyle);\n          } else {\n            DomUtil.addClass(list[0], selectedStyle);\n          }\n          DomEvent.preventDefault(e);\n          break;\n        default:\n          // when the input changes we should cancel all pending suggestion requests if possible to avoid result collisions\n          for (var x = 0; x < this._geosearchCore._pendingSuggestions.length; x++) {\n            var request = this._geosearchCore._pendingSuggestions[x];\n            if (request && request.abort && !request.id) {\n              request.abort();\n            }\n          }\n          break;\n      }\n    }, this);\n\n    DomEvent.addListener(this._input, 'keyup', Util.throttle(function (e) {\n      var key = e.which || e.keyCode;\n      var text = (e.target || e.srcElement).value;\n\n      // require at least 2 characters for suggestions\n      if (text.length < 2) {\n        this._suggestions.innerHTML = '';\n        this._suggestions.style.display = 'none';\n        return;\n      }\n\n      // if this is the escape key it will clear the input so clear suggestions\n      if (key === 27) {\n        this._suggestions.innerHTML = '';\n        this._suggestions.style.display = 'none';\n        return;\n      }\n\n      // if this is NOT the up/down arrows or enter make a suggestion\n      if (key !== 13 && key !== 38 && key !== 40) {\n        if (this._input.value !== this._lastValue) {\n          this._lastValue = this._input.value;\n          this._geosearchCore._suggest(text);\n        }\n      }\n    }, 50, this), this);\n  }\n});\n\nexport function search (options) {\n  return new Search(options);\n}\n"],"names":["Search","Layer","extend","options","allowMultipleResults","placeholder","title","wrapperStyle","suggestionGroupStyle","selectedStyle","initialize","Util","setOptions","this","providers","arcgisOnlineProvider","_geosearchCore","geosearchCore","addEventParent","_pendingSuggestions","_providers","_renderSuggestions","suggestions","list","nodes","_suggestions","style","display","i","length","suggestion","DomUtil","create","suggestionItem","innerHTML","text","provider","magicKey","push","clear","_input","value","clearSuggestions","_nodes","k","parentElement","removeChild","onAdd","map","_map","EsriUtil","setEsriAttribution","document","getElementById","inputTag","_wrapper","createElement","addClass","parentNode","insertBefore","appendChild","DomEvent","addListener","e","target","srcElement","_geocode","selectedPosition","querySelectorAll","selected","keyCode","innerText","undefined","preventDefault","L","removeClass","previousItem","nextItem","x","request","abort","id","throttle","key","which","_lastValue","_suggest"],"mappings":"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"}